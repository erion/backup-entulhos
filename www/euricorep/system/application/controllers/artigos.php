<?php    Class Artigos extends Controller {        function Artigos(){            parent::Controller();            $this->load->model('artigo');            $this->data['titulo'] = $this->artigo->titulo;            $this->data['usuario_logado'] = $this->session->userdata('nome');            $this->data['tipo_usuario'] = $this->session->userdata('tipo');            verificar_permissao($this->session->userdata('tipo'),array('SAD','ADM'));            seleciona_menu($this,'cadastro_menu');        }        function listar(){            $a = new Artigo();            $a->where('invisivel','0');            $CI = &get_instance();            $por_pagina = $CI->config->item('pedidos_por_pagina');            if($this->input->get('order')) {                if($this->input->get('campo') == 'id')                    $a->order_by('id',$this->input->get('order'));                else                    $a->order_by('nome',$this->input->get('order'));            } else $a->order_by('nome');            $this->data['a'] = $a->get($por_pagina,$this->input->get('per_page'))->all;            $this->load->library('pagination');            $this->pagination->initialize(config_pagination('artigos/listar', $a->count(),'per_page'));                        $this->view->load('artigo/listar',$this->data);        }        function cadastrar(){            $post = $this->input->post('artigo');            $this->data['jsatual'] = array('artigo_cadastrar');            if (empty($post)) {                $this->data['artigo'] = $a = new Artigo();                $this->view->load('artigo/form',$this->data);            } else {                $this->data['artigo'] = $a = new Artigo($this->input->post('artigo'));                if ($a->save()) {                    redirect('artigos/listar');                }                $this->view->load('artigo/form',$this->data);            }        }        function detalhes($id,$pag = null) {            $post = $this->input->post('artigo');            $this->data['jsatual'] = array('artigo_cadastrar');            if (empty($post)) {                $a = new Artigo();                $this->data['artigo'] = $a->get_by_id($id);                $this->view->load('artigo/form',$this->data);            } else {                $this->data['artigo'] = $a = new Artigo($this->input->post('artigo'));                $a->id = $id;                if ($a->save()) {                    $uri = 'artigos/listar?per_page='.$pag;                    redirect($uri);                }                $this->view->load('artigo/form',$this->data);            }        }        function excluir($id,$pag = null) {            $a = new Artigo();            $a->get_by_id($id);            $p = new Pedido();            $p->get_by_artigo_id($id);            if (empty($p->id)) {                $a->delete();            } else {                $a->invisivel = "1";                $a->save();            }            $uri = 'artigos/listar/'.$pag;            redirect($uri);        }    }?>