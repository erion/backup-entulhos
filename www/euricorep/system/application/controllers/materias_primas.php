<?php    Class Materias_primas extends Controller {        function Materias_primas() {            parent::Controller();            $this->load->model('materia_prima');            $this->data['titulo'] = $this->materia_prima->titulo;            $this->data['usuario_logado'] = $this->session->userdata('nome');            $this->data['tipo_usuario'] = $this->session->userdata('tipo');            verificar_permissao($this->session->userdata('tipo'),array('SAD','ADM'));            seleciona_menu($this,'cadastro_menu');        }        function listar() {            $this->data['mat_prima'] = $m = new Materia_prima();            $m->where('invisivel','0');            $CI = &get_instance();            $por_pagina = $CI->config->item('pedidos_por_pagina');            if($this->input->get('order')) {                $m->order_by($this->input->get('campo'),$this->input->get('order'));            } else $m->order_by('nome');                        $this->data['m'] = $m->get($por_pagina,$this->input->get('per_page'))->all;            $this->load->library('pagination');            $this->pagination->initialize(config_pagination('materias_primas/listar',$m->count(),'per_page'));            $this->view->load('materia_prima/listar',$this->data);        }        function cadastrar() {            $post = $this->input->post('mat_prima');            $this->data['jsatual'] = array('materia_prima_cadastrar');            if (empty($post)) {                $this->data['mat_prima'] = $m = new Materia_prima();                $this->view->load('materia_prima/form',$this->data);            } else {                $this->data['mat_prima'] = $m = new Materia_prima($this->input->post('mat_prima'));                if ($m->save()){                    redirect('materias_primas/listar');                }                $this->view->load('materia_prima/form',$this->data);            }        }        function detalhes($id,$pag = null) {            $post = $this->input->post('mat_prima');            $this->data['jsatual'] = array('materia_prima_cadastrar');            if (empty($post)) {                $m = new Materia_prima();                $this->data['mat_prima'] = $m->get_by_id($id);                $this->view->load('materia_prima/form',$this->data);            } else {                $this->data['mat_prima'] = $m = new Materia_prima($this->input->post('mat_prima'));                $m->id = $id;                if ($m->save()){                    $uri = 'materias_primas/listar?per_page='.$pag;                    redirect($uri);                }                $this->view->load('materia_prima/form',$this->data);            }        }        function excluir($id, $pag = null) {            $this->data['mat_prima'] = $m = new Materia_prima();            $m->get_by_id($id);            $p = new Pedido();            $p->get_by_materia_prima_id($id);            if (empty($p->id)) {                $m->delete();            } else {                $m->invisivel = "1";                $m->save();            }            $uri = 'materias_primas/listar/'.$pag;            redirect($uri);        }    }?>